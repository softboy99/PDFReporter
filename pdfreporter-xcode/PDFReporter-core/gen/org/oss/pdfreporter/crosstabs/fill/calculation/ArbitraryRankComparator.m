//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: pdfreporter-core/src/org/oss/pdfreporter/crosstabs/fill/calculation/ArbitraryRankComparator.java
//
//  Created by kendra on 9/27/13.
//

#include "java/lang/Long.h"
#include "org/oss/pdfreporter/crosstabs/fill/calculation/ArbitraryRankComparator.h"
#include "org/oss/pdfreporter/engine/JRRuntimeException.h"
#include "org/oss/pdfreporter/uses/org/apache/commons/collections/ReferenceMap.h"

@implementation OrgOssPdfreporterCrosstabsFillCalculationArbitraryRankComparator

@synthesize ranks = ranks_;
@synthesize rankCounter = rankCounter_;

- (int)compareWithId:(id)o1
              withId:(id)o2 {
  if (o1 == o2 || [nil_chk(o1) isEqual:o2]) {
    return 0;
  }
  long long int rank1 = [self rankWithId:o1];
  long long int rank2 = [self rankWithId:o2];
  if (rank1 < rank2) {
    return -1;
  }
  if (rank1 > rank2) {
    return 1;
  }
  @throw [[OrgOssPdfreporterEngineJRRuntimeException alloc] initWithNSString:@"Arbitrary rank comparator found two objects with the same rank"];
}

- (long long int)rankWithId:(id)o {
  @synchronized(self) {
    {
      long long int rank;
      JavaLangLong *existingRank = (JavaLangLong *) [((OrgOssPdfreporterUsesOrgApacheCommonsCollectionsReferenceMap *) nil_chk(ranks_)) getWithId:o];
      if (existingRank == nil) {
        rank = rankCounter_;
        ++rankCounter_;
        if (rankCounter_ == JavaLangLong_MIN_VALUE) {
          @throw [[OrgOssPdfreporterEngineJRRuntimeException alloc] initWithNSString:@"Arbitrary rank comparator has overflowed"];
        }
        (void) [((OrgOssPdfreporterUsesOrgApacheCommonsCollectionsReferenceMap *) nil_chk(ranks_)) putWithId:o withId:[[JavaLangLong alloc] initWithLongInt:rank]];
      }
      else {
        rank = [existingRank longLongValue];
      }
      return rank;
    }
  }
}

- (id)init {
  if ((self = [super init])) {
    ranks_ = [[OrgOssPdfreporterUsesOrgApacheCommonsCollectionsReferenceMap alloc] initWithInt:OrgOssPdfreporterUsesOrgApacheCommonsCollectionsReferenceMap_WEAK withInt:OrgOssPdfreporterUsesOrgApacheCommonsCollectionsReferenceMap_HARD];
    rankCounter_ = JavaLangLong_MIN_VALUE;
  }
  return self;
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  OrgOssPdfreporterCrosstabsFillCalculationArbitraryRankComparator *typedCopy = (OrgOssPdfreporterCrosstabsFillCalculationArbitraryRankComparator *) copy;
  typedCopy.ranks = ranks_;
  typedCopy.rankCounter = rankCounter_;
}

@end
